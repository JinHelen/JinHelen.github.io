<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å›¾ä¹¦æ¨èç³»ç»Ÿï¼ˆä¸€ï¼‰â€”â€”æ•°æ®åˆ†æ | JinHelen</title>
<link rel="shortcut icon" href="https://JinHelen.github.io/favicon.ico?v=1555574550150">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://JinHelen.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://JinHelen.github.io">
  <img class="avatar" src="https://JinHelen.github.io/images/avatar.png?v=1555574550150" alt="">
  </a>
  <h1 class="site-title">
    JinHelen
  </h1>
  <p class="site-description">
    I can do it!
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/smile836" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

      
        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              å›¾ä¹¦æ¨èç³»ç»Ÿï¼ˆä¸€ï¼‰â€”â€”æ•°æ®åˆ†æ
            </h2>
            <div class="post-info">
              <time class="post-time">
                Â· 2019-04-18 Â·
              </time>
              
                <a href="https://JinHelen.github.io/tag/50RlkVQ2x" class="post-tags">
                  # æ¨èç³»ç»Ÿ
                </a>
              
            </div>
            
              <div class="post-feature-image" style="background-image: url('https://JinHelen.github.io/post-images/tu-shu-tui-jian-xi-tong-yi-shu-ju-fen-xi.jpg')">
              </div>
            
            <div class="post-content">
              <p>ğŸŒ±å¯¹è±†ç“£å›¾ä¹¦çš„æ•°æ®é›†è¿›è¡Œåˆ†æ</p>
<!-- more -->
<h2 id="1-æ•°æ®å‡†å¤‡">1 æ•°æ®å‡†å¤‡</h2>
<p>æ¥è‡ª <a href="http://opendata.pku.edu.cn/dataset.xhtml?persistentId=doi:10.18170/DVN/LA9GRH">è±†ç“£å›¾ä¹¦æ•°æ®é›†</a>ï¼Œè¡¨ç»“æ„æ˜¯ç”¨æˆ·id-å›¾ä¹¦id-è¯„åˆ†ã€‚</p>
<h2 id="2-æ•°æ®åˆ†æ">2 æ•°æ®åˆ†æ</h2>
<h3 id="21-æ ¹æ®å›¾ä¹¦åˆ†æç”¨æˆ·æ•°">2.1 æ ¹æ®å›¾ä¹¦åˆ†æç”¨æˆ·æ•°</h3>
<p>æ€è·¯ï¼šåˆ†æç”¨æˆ·è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°çš„Næœ¬å›¾ä¹¦å¯¹åº”çš„è¯„åˆ†ç”¨æˆ·æ•°ã€‚
å…ˆæ ¹æ®å›¾ä¹¦</p>
<p>ï¼ˆ1ï¼‰åŠ è½½æ•°æ®é›†ï¼Œæ”¾å…¥å­—å…¸ç»“æ„</p>
<pre><code>def _load_data(file_path):
	book_rate_map = dict()
	for line in open(file_path,&quot;r&quot;,encoding=&quot;utf-8&quot;).readlines():
		 user,bookid,rate = line.strip().split(&quot;::&quot;)
		 #book_rate_map={bookid:{user:score}}
		 book_rate_map.setfault(bookid,{})
		 book_rate_map[bookid][user] = score
return book_rate_map					
</code></pre>
<p>(2)è·å–è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°‘çš„Næœ¬å›¾ä¹¦</p>
<pre><code>def _most_rate_books(k):
	book_rate_score = _load_data(&quot;./data/douban.dat&quot;)
	#å›¾ä¹¦id-è¯„åˆ†äººæ•°æ•°æ®é›†
  book_rate_num = dict()
  #ç”¨æˆ·åæ•°æ®é›†ï¼Œset()å‡½æ•°åˆ›å»ºä¸€ä¸ªæ— åºä¸é‡å¤å…ƒç´ é›†
  users = set()
	#è®¡ç®—æ¯æœ¬å›¾ä¹¦ä¸‹çš„ç”¨æˆ·æ•°ï¼Œä»¥åŠå±•ç¤ºç”¨æˆ·
	for key in book_rate_score.keys():
		book_rate_num[key] =len(book_rate_score[key])
		for user in book_rate_score[key].keys():
			users.add(user)
	#æŒ‰ç…§è¯„åˆ†äººæ•°ï¼Œä»å¤§åˆ°å°æ’åº
	new_book_rate_num = sorted(book_rate_num.items(),key = lambda k:k[1],reverse = True)
	print(&quot;æ€»æœ‰å›¾ä¹¦æ•°ç›®ï¼š{}&quot;.format(new_book_rate_num.__len__()))
	print(&quot;æ€»æœ‰ç”¨æˆ·æ•°ç›®ï¼š{}&quot;.format(users.__len__()))
	#æŒ‰ç…§è¯„åˆ†äººæ•°ï¼Œä»å°åˆ°å¤§æ’åº
	new_1_book_rate_num = sorted(book_rate_num.items(),key = lambda k:k[1],reverse = False)
	#è¿”å›è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°‘çš„Næœ¬å›¾ä¹¦idåˆ—è¡¨+åŸæ•°æ®é›†
	return list(dict(new_book_rate_num[:k]).keys())+list(dict(new_1_book_rate_num[:k]).keys()),book_rate_score
</code></pre>
<p>(3)è·å–ç”¨æˆ·è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°çš„Næœ¬å›¾ä¹¦å¯¹åº”çš„è¯„åˆ†ç”¨æˆ·</p>
<pre><code>def _topk_book_to_user():
	user = set()
	books,book_rate_score = _most_rate_books(30):
		for book in books:
			for user in book_rate_score[book].keys():
				users.add(user)
			print(users.__user__)
</code></pre>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code># -*- coding: utf-8 -*-

&quot;&quot;&quot;
    Authorï¼šSmilehe
    Dateï¼š2019-04-16
    Descï¼šåˆ†æè±†ç“£æ•°æ®é›†ä¸­è¯„åˆ†æœ€å¤šçš„Næœ¬å›¾ä¹¦å’Œæœ€å°‘çš„Næœ¬å›¾ä¹¦æ¶‰åŠçš„ç”¨æˆ·æ•°
    æ€è·¯ï¼š
    1ã€åŠ è½½æ•°æ®ï¼Œè¿”å›å­—å…¸ç»“æ„ï¼Œæ•°æ®é›†å½¢å¼ä¸ºï¼š{bookid:{user:score}}
    2ã€è¦è·å–ç”¨æˆ·è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°çš„Næœ¬å›¾ä¹¦å¯¹åº”çš„è¯„åˆ†ç”¨æˆ·æ•°
    ï¼ˆ1ï¼‰è®¡ç®—æ¯æœ¬å›¾ä¹¦ä¸‹çš„ç”¨æˆ·æ•°ï¼Œå¾—åˆ°å›¾ä¹¦id-ç”¨æˆ·æ•°æ•°æ®è¡¨ï¼Œè®°å½•ä¸‹ç”¨æˆ·å
    ï¼ˆ2ï¼‰æŒ‰ç…§è¯„åˆ†äººæ•°ï¼Œé‡‡ç”¨å€’æ’å’Œæ­£æ’ï¼Œåˆ†åˆ«å–å‰Næœ¬å›¾ä¹¦
    ï¼ˆ3ï¼‰è¿”å›2Næœ¬å›¾ä¹¦idå’ŒåŸæ•°æ®é›†
    ï¼ˆ4ï¼‰éå†å¾—åˆ°çš„2Næœ¬å›¾ä¹¦idï¼Œè·å–æ¯æœ¬å›¾ä¹¦ä¸‹çš„ç”¨æˆ·åï¼Œè®¡ç®—ç”¨æˆ·æ•°
&quot;&quot;&quot;

#åŠ è½½æ•°æ®é›†ï¼Œè¿”å›å­—å…¸ç»“æ„
def _load_data(file_path):
    book_rate_map = dict()
    for line in open(file_path,&quot;r&quot;,encoding=&quot;utf-8&quot;).readlines():
        user, bookid, score = line.strip().split(&quot;::&quot;)
        #book_rate_map={bookid:{user:score}}
        book_rate_map.setdefault(bookid,{})
        book_rate_map[bookid][user]=score
    return book_rate_map
#è·å–ç”¨æˆ·è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°‘çš„Næœ¬å›¾ä¹¦ï¼Œä»¥åŠå›¾ä¹¦è¯„åˆ†å­—å…¸
def _most_rate_books(k):
    #å›¾ä¹¦id-ç”¨æˆ·-è¯„åˆ†æ•°æ®é›†
    book_rate_score = _load_data(&quot;./data/douban.dat&quot;)
    #å›¾ä¹¦id-ç”¨æˆ·æ•°æ•°æ®é›†
    book_rate_num = dict()
    #ç”¨æˆ·åæ•°æ®é›†ï¼Œset()å‡½æ•°åˆ›å»ºä¸€ä¸ªæ— åºä¸é‡å¤å…ƒç´ é›†
    users = set()
    #è¿™é‡Œçš„keysæ˜¯æŒ‡bookid
    for key in book_rate_score.keys():
        #è®¡ç®—bookidä¸‹çš„ç”¨æˆ·æ•°
        book_rate_num[key] = len(book_rate_score[key])
        #è¿™é‡Œçš„keysæŒ‡user
        for user in book_rate_score[key].keys():
            #å­˜ä¸‹ç”¨æˆ·å
            users.add(user)
    #æŒ‰ç…§è¯„åˆ†äººæ•°å€’æ’ï¼Œrevers=True è¡¨ç¤ºä»å¤§åˆ°å°æ’åº
    # å›¾ä¹¦id-ç”¨æˆ·æ•°æ•°æ®é›† ä»å¤§åˆ°å°
    new_book_rate_num = sorted(book_rate_num.items(),key= lambda k:k[1],reverse=True)
    #__len__è¿”å›å…ƒç´ çš„ä¸ªæ•°
    print(&quot;æ€»æœ‰å›¾ä¹¦æ•°ç›®ï¼š{}&quot;.format(new_book_rate_num.__len__()))
    print(&quot;æ€»æœ‰ç”¨æˆ·æ•°æ®ï¼š{}&quot;.format(users.__len__()))
    # print(dict(new_book_rate_num[:k]))
    # æŒ‰ç…§è¯„åˆ†äººæ•°æ­£æ’ï¼Œrevers=False è¡¨ç¤ºä»å°åˆ°å¤§æ’åº
    # å›¾ä¹¦id-ç”¨æˆ·æ•°æ•°æ®é›† ä»å°åˆ°å¤§
    new_1_book_rate_num = sorted(book_rate_num.items(), key=lambda k: k[1], reverse=False)
    #è¿”å›è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°‘çš„Næœ¬å›¾ä¹¦id+åŸæ•°æ®é›†
    return list(dict(new_book_rate_num[:k]).keys())+list(dict(new_1_book_rate_num[:k]).keys()),book_rate_score

# è·å–ç”¨æˆ·è¯„åˆ†æœ€å¤šçš„å’Œæœ€å°çš„Næœ¬å›¾ä¹¦å¯¹åº”çš„è¯„åˆ†ç”¨æˆ·
def _topk_book_to_user():
    users = set()
    books, book_rate_score = _most_rate_books(30)
    for book in books:
        for user in book_rate_score[book].keys():
            users.add(user)
        print(users.__len__())

_topk_book_to_user()
</code></pre>
<p>è¿è¡Œç»“æœéƒ¨åˆ†å†…å®¹ï¼š</p>
<pre><code>æ€»æœ‰å›¾ä¹¦æ•°ç›®ï¼š80008
æ€»æœ‰ç”¨æˆ·æ•°æ®ï¼š383033
2071
2200
4107
4248
4457
...
19153
19154
19155
19156
19156
æ³¨æ„ï¼šæ•°å­—ä»£è¡¨æ¯æœ¬å›¾ä¹¦ä¸‹çš„ç”¨æˆ·æ•°
</code></pre>
<h3 id="22-æ ¹æ®ç”¨æˆ·åˆ†æå›¾ä¹¦æ•°">2.2 æ ¹æ®ç”¨æˆ·åˆ†æå›¾ä¹¦æ•°</h3>

            </div>
          </article>
        </div>
    
        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://JinHelen.github.io/post/hello-gridea">
              <h3 class="post-title">
                Hello Gridea
              </h3>
            </a>
          </div>  
        

        
    
        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
